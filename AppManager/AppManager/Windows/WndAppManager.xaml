<Window
	xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:am="clr-namespace:AppManager"
	x:Class="AppManager.WndAppManager"
	x:Name="AppsManagerWindow"
	mc:Ignorable="d" 
	Title="{Binding Source={x:Static am:Strings.APP_MANAGER}}"
	Width= "375" Height="480"  
	WindowStartupLocation="CenterOwner" 
   Icon="/AppManager;component/Resources/Window.png" 
   ShowInTaskbar="False" 
   MinWidth="250" MinHeight="300"
	Activated="AppsManagerWindow_Activated">
	
	<Window.Resources>
		<Style x:Key="AppTypeItemStyle" TargetType="ListBoxItem">
			<!--<Setter Property="Background" Value="Transparent"/>
            <Setter Property="HorizontalContentAlignment" Value="{Binding Path=HorizontalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"/>
            <Setter Property="VerticalContentAlignment" Value="{Binding Path=VerticalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"/>
            <Setter Property="Padding" Value="2,0,0,0"/>-->
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="{x:Type ListBoxItem}">
						<Border x:Name="Bd" SnapsToDevicePixels="true" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Padding="{TemplateBinding Padding}">
							<ContentPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsSelected" Value="true">
								<!--<Setter Property="Foreground" Value="Red"/>-->
								<Setter Property="Background" TargetName="Bd" Value="#FFB0CCF7"/>
							</Trigger>
							<MultiTrigger>
								<MultiTrigger.Conditions>
									<Condition Property="IsSelected" Value="true"/>
									<Condition Property="Selector.IsSelectionActive" Value="false"/>
								</MultiTrigger.Conditions>
								<Setter Property="Background" TargetName="Bd" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
								<Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
							</MultiTrigger>
							<Trigger Property="IsEnabled" Value="false">
								<Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
		<Style x:Key="AppItemStyle" TargetType="ListViewItem">
			<!--<Setter Property="Background" Value="Transparent"/>
            <Setter Property="HorizontalContentAlignment" Value="{Binding Path=HorizontalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"/>
            <Setter Property="VerticalContentAlignment" Value="{Binding Path=VerticalContentAlignment, RelativeSource={RelativeSource AncestorType={x:Type ItemsControl}}}"/>
            <Setter Property="Padding" Value="2,0,0,0"/>-->
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="{x:Type ListViewItem}">
						<Border x:Name="Bd" SnapsToDevicePixels="true" Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Padding="{TemplateBinding Padding}">
							<GridViewRowPresenter HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}" VerticalAlignment="{TemplateBinding VerticalContentAlignment}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"/>
						</Border>
						<ControlTemplate.Triggers>
							<Trigger Property="IsSelected" Value="true">
								<!--<Setter Property="Foreground" Value="#FFDFDFDF"/>-->
								<Setter Property="Background" TargetName="Bd" Value="#FFB0CCF7"/>
							</Trigger>
							<MultiTrigger>
								<MultiTrigger.Conditions>
									<Condition Property="IsSelected" Value="true"/>
									<Condition Property="Selector.IsSelectionActive" Value="false"/>
								</MultiTrigger.Conditions>
								<Setter Property="Background" TargetName="Bd" Value="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"/>
								<Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.ControlTextBrushKey}}"/>
							</MultiTrigger>
							<Trigger Property="IsEnabled" Value="false">
								<Setter Property="Foreground" Value="{DynamicResource {x:Static SystemColors.GrayTextBrushKey}}"/>
							</Trigger>
						</ControlTemplate.Triggers>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
		<DataTemplate x:Key="myHeaderTemplate">
			<DockPanel>
				<CheckBox Click="CheckBox_Click" />
			</DockPanel>
		</DataTemplate>
		<!--<Style x:Key="AppItemStyle" TargetType="ListViewItem">
			<Style.Resources>
				<SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#FFB0CCF7"/>
				<SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="#FFDFDFDF"/>
			</Style.Resources>
        </Style>-->
		<!--<Style x:Key="AppTypeItemStyle" TargetType="ListBoxItem">
			<Style.Resources>
				<SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#FFB0CCF7"/>
				<SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="#FFDFDFDF"/>
			</Style.Resources>
        </Style>-->
		<!--<Style x:Key="AppItemText" TargetType="TextBox">
			<Style.Resources>
				<SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="#FFB0CCF7"/>
				<SolidColorBrush x:Key="{x:Static SystemColors.ControlBrushKey}" Color="#FFDFDFDF"/>
				<SolidColorBrush x:Key="{x:Static SystemColors}" Color="#FFDFDFDF"/>
			</Style.Resources>
		</Style>-->
		<DataTemplate x:Key="CheckCell">
			<StackPanel x:Name="Back" Orientation="Horizontal">
				<CheckBox Name="SelectedCheckBox" IsChecked="{Binding Path=Checked}" />
			</StackPanel>
		</DataTemplate>
		<!--<DataTemplate x:Key="ImageCell">
			<StackPanel Orientation="Horizontal">
				<Image Width="24" Height="24" Stretch="UniformToFill" Source="{Binding Path=AppImage}" />
			</StackPanel>
		</DataTemplate>-->
		<!--<DataTemplate x:Key="AppInfo">
			<StackPanel Orientation="Vertical">
				<TextBlock Text="{Binding Path=AppName}"/>
				<TextBlock Text="{Binding Path=AppPath}"/>
			</StackPanel>
		</DataTemplate>-->
		<DataTemplate x:Key="AppTypeInfo">
			<StackPanel x:Name="Back" Orientation="Vertical" Margin="4,2,0,2">
				<TextBlock Text="{Binding Path=AppTypeName}" FontSize="12"/>
				<TextBlock Text="{Binding Path=AppTypeInfo}" FontSize="10" Foreground="#FF7A7979"/>
			</StackPanel>
		</DataTemplate>
		<!--<DataTemplate x:Key="EditableAppInfo">
			<Grid Name="GridT" Height="40" Background="Cyan">
				<Grid.RowDefinitions>
					<RowDefinition Height="50*" />
					<RowDefinition Height="50*" />
				</Grid.RowDefinitions>
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="50*" />
					<ColumnDefinition Width="28" />
				</Grid.ColumnDefinitions>
				<TextBox Grid.ColumnSpan="2" Text="{Binding Path=AppName, Mode=TwoWay}" BorderBrush="{x:Null}" Width="250" Background="{x:Null}"/>
				<TextBlock Name="AppItemPath" Grid.Row="1" Text="{Binding Path=AppPath, Mode=TwoWay}" Margin="4,4,0,0"/>
				<Button Name="AppItemPathSelect" Content="..." Grid.Row="1" Grid.Column="1" Click="AppPathSelect_Click" />
			</Grid>
		</DataTemplate>-->
		<DataTemplate x:Key="EditableAppInfo">
			<Border Name="Back" BorderThickness="0,0,0,1" BorderBrush="#FFADADAD" Padding="0,0,0,4">
				<!--Width="{Binding (FrameworkElement.ActualWidth), RelativeSource={RelativeSource Mode= AncestorType=ScrollContentPresenter}}">-->
				<Grid Name="GridT">
					<!--<Grid.Width>
						<Binding Path="Width" Mode="OneWay">
							<Binding.RelativeSource>
								<RelativeSource Mode="FindAncestor" AncestorType="ListBox"/>
							</Binding.RelativeSource>
						</Binding>
					</Grid.Width>-->
					<Grid.RowDefinitions>
						<RowDefinition Height="50*" />
						<RowDefinition Height="50*" />
					</Grid.RowDefinitions>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="40" MaxWidth="40" />
						<ColumnDefinition Width="*" />
						<ColumnDefinition Width="28" MaxWidth="28" />
					</Grid.ColumnDefinitions>
					<Image Grid.RowSpan="2" Source="{Binding Path=AppImage}" Width="24" Height="24" />
					<TextBox 
						Grid.Column="1" 
						Grid.ColumnSpan="2" 
						Text="{Binding Path=AppName, Mode=TwoWay}" 
						BorderBrush="{x:Null}" 
						HorizontalAlignment="Stretch" 
						GotFocus="TextBox_GotFocus"
                        Background="Transparent"
                        >

						<!--<TextBox.Background>
							<Binding Path="Background">
								<Binding.RelativeSource>
									<RelativeSource Mode="FindAncestor" AncestorType="ScrollContentPresenter"/>
								</Binding.RelativeSource>
							</Binding>
						</TextBox.Background>-->
					</TextBox>
					<!--<TextBlock TextTrimming="WordEllipsis" Grid.Column="1" x:Name="AppItemPath" Grid.Row="1" Text="{Binding Path=AppPath, Mode=TwoWay}" Margin="4,4,0,0" HorizontalAlignment="Left"/>-->
					<TextBox 
						Grid.Column="1" 
						Grid.Row="1"
						x:Name="AppItemPath" 
						Text="{Binding Path=ExecPath, Mode=TwoWay}" 
						Margin="0,1,0,0" 
						BorderBrush="{x:Null}" 
						HorizontalAlignment="Stretch" 
						GotFocus="TextBox_GotFocus"
                        Background="Transparent">
						<!--<TextBox.Background>
							<Binding Path="Background">
								<Binding.RelativeSource>
									<RelativeSource Mode="FindAncestor" AncestorType="ScrollContentPresenter"/>
								</Binding.RelativeSource>
							</Binding>
						</TextBox.Background>-->
					</TextBox>
					<Button x:Name="AppItemPathSelect" Content="..." Grid.Row="1" Grid.Column="2" Width="28" Click="AppPathSelect_Click" />
				</Grid>
			</Border>
		</DataTemplate>
		<DataTemplate x:Key="SemiEditableAppInfo">
			<Border Name="BorderT" BorderThickness="0,0,0,1" BorderBrush="#FFADADAD" Padding="0,0,0,4">
				<Border.Width>
					<Binding Path="ActualWidth">
						<Binding.RelativeSource>
							<RelativeSource Mode="FindAncestor" AncestorType="ScrollContentPresenter"/>
						</Binding.RelativeSource>
					</Binding>
				</Border.Width>
				<Grid Name="GridT">
					<Grid.RowDefinitions>
						<RowDefinition Height="50*" />
						<RowDefinition Height="50*" />
					</Grid.RowDefinitions>
					<Grid.ColumnDefinitions>
						<ColumnDefinition Width="40" />
						<ColumnDefinition Width="*" />
					</Grid.ColumnDefinitions>
					<Image Grid.RowSpan="2" Source="{Binding Path=AppImage}" Width="24" Height="24" />
					<TextBox Grid.Column="1" Text="{Binding Path=AppName, Mode=TwoWay}" BorderBrush="{x:Null}" Width="Auto" Background="{x:Null}" HorizontalAlignment="Stretch" GotFocus="ScanTextBox_GotFocus" />
					<TextBlock Grid.Column="1" x:Name="AppItemPath" Grid.Row="1" Text="{Binding Path=ExecPath, Mode=OneWay}" Margin="4,4,0,0" HorizontalAlignment="Left"/>
				</Grid>
			</Border>
		</DataTemplate>
		<!--</SnippetCheckBoxDataTemplate>-->
	</Window.Resources>

	<Grid x:Name="LayoutRoot">
		<Grid.RowDefinitions>
			<RowDefinition Height="*"/>
			<RowDefinition Height="44"/>
		</Grid.RowDefinitions>
		<TabControl Name="AppTabs" IsSynchronizedWithCurrentItem="True">
			<TabItem Header="{Binding Source={x:Static am:Strings.APP_TYPES}}">
				<Grid>
					<Grid.RowDefinitions>
						<RowDefinition Height="44" />
						<RowDefinition Height="306.723*" />
						<RowDefinition Height="8" />
					</Grid.RowDefinitions>
					<ListBox 
						ItemTemplate="{StaticResource AppTypeInfo}"
						ItemContainerStyle="{StaticResource AppTypeItemStyle}"
						IsSynchronizedWithCurrentItem="True" 
						x:Name="AppTypes" Margin="8,0,8,0" Grid.Row="1" />
					<Grid>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="100*" />
							<ColumnDefinition Width="Auto" MinWidth="20" />
							<ColumnDefinition Width="Auto" MinWidth="20" />
							<ColumnDefinition Width="Auto" MinWidth="20" />
							<ColumnDefinition Width="Auto" MinWidth="24" />
						</Grid.ColumnDefinitions>
						<Label 
							Margin="8,9,0,6" Content="{Binding Source={x:Static am:Strings.APP_TYPE_NAME}}" 
							x:Name="AppTypeLabel" HorizontalAlignment="Left"/>
						<TextBox
							Text="{Binding Path=SelectedItem.AppTypeName, ElementName=AppTypes, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
							TextWrapping="Wrap" 
							x:Name="AppTypeName" 
							Grid.Column="1" 
							Margin="4,12" />
						<Button Width="24" x:Name="BtnAppTypeUp" Margin="0,12,4,12" Grid.Column="2" Click="BtnAppTypeUp_Click">
							<Image Source="/AppManager;component/Resources/up_16.png" />
						</Button>
						<Button Width="24" x:Name="BtnAppTypeDown" Margin="0,12,4,12" Grid.Column="3" Click="BtnAppTypeDown_Click">
							<Image Source="/AppManager;component/Resources/down_16.png" />
						</Button>
						<Button Width="24" Content="+" x:Name="BtnAddAppType" Click="BtnAddAppType_Click" Margin="0,12,4,12" Grid.Column="4" />
						<Button Width="24" Content="-" x:Name="BtnRemoveAppType" Click="BtnRemoveAppType_Click" Grid.Column="5" HorizontalAlignment="Left" Margin="0,12,8,12" />
					</Grid>
				</Grid>
			</TabItem>
			<TabItem Header="{Binding Source={x:Static am:Strings.APPLICATIONS}}">
				<Grid Height="Auto" Width="Auto" Name="AppTypesApp">
					<Grid.RowDefinitions>
						<RowDefinition Height="44" />
						<RowDefinition Height="306.723*" />
						<RowDefinition Height="8"/>
					</Grid.RowDefinitions>
					<ListBox
						Grid.Row="1"
						Margin="8,0"
						Name="AppList" 
						ItemsSource="{Binding ElementName=AppTypeSelector, Path=SelectedItem.AppInfos}"
						HorizontalContentAlignment="Stretch"
						IsSynchronizedWithCurrentItem="True"
						ItemTemplate="{DynamicResource EditableAppInfo}"
						ItemContainerStyle="{DynamicResource AppTypeItemStyle}"
						ScrollViewer.HorizontalScrollBarVisibility="Disabled" SelectionMode="Extended">
						<ListBox.ItemsPanel>
							<ItemsPanelTemplate>
								<VirtualizingStackPanel 
									 Orientation="Vertical" 
									 IsItemsHost="True"
									 Width="{Binding Path=ActualWidth, 
											RelativeSource={RelativeSource Mode=FindAncestor, 
											AncestorType= {x:Type ScrollContentPresenter}}}" />
							</ItemsPanelTemplate>
						</ListBox.ItemsPanel>
					</ListBox>
					<ComboBox 
						DisplayMemberPath="AppTypeName" 
						Margin="8,12,120,12" 
						Name="AppTypeSelector" SelectedIndex="0" />
					<Button HorizontalAlignment="Right" Margin="0,12,92,12" Name="BtnAppUp" VerticalAlignment="Top" Width="24" Click="BtnAppUp_Click">
						<Image Source="/AppManager;component/Resources/up_16.png" />
					</Button>
					<Button HorizontalAlignment="Right" Margin="0,12,64,12" Name="BtnAppDown" VerticalAlignment="Top" Width="24" Click="BtnAppDown_Click">
						<Image Source="/AppManager;component/Resources/down_16.png" />
					</Button>
					<Button HorizontalAlignment="Right" Margin="0,12,36,12" Name="BtnAddApp" VerticalAlignment="Top" Width="24" Click="BtnAddApp_Click">+</Button>
					<Button HorizontalAlignment="Right" Margin="0,12,8,12" Name="BtnRemoveApp" VerticalAlignment="Top" Width="24" Click="BtnRemoveApp_Click">-</Button>
				</Grid>
			</TabItem>
			<TabItem Header="{Binding Source={x:Static am:Strings.SEARCH}}">
				<Grid Height="Auto" Width="Auto">
					<Grid.RowDefinitions>
						<RowDefinition Height="76" />
						<RowDefinition Height="293.723*" />
						<RowDefinition Height="8" />
					</Grid.RowDefinitions>
					<Grid>
						<Grid.RowDefinitions>
							<RowDefinition Height="38" />
							<RowDefinition Height="38" />
						</Grid.RowDefinitions>
						<Grid.ColumnDefinitions>
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="100*" />
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="Auto" />
							<ColumnDefinition Width="Auto" />
						</Grid.ColumnDefinitions>
						<StackPanel Margin="8,12,8,6" Grid.ColumnSpan="6" Orientation="Horizontal">
						<Button 
							Name="BtnScanQuickLaunch" 
							Content="{Binding Source={x:Static am:Strings.SCAN_QUICK_LAUNCH}}" 
							Click="BtnScanQuickLaunch_Click" />
						<Button 
							Name="BtnScanAllProgs" 
							Margin="4,0,0,0"
							Content="{Binding Source={x:Static am:Strings.SCAN_ALL_PROGS}}" 
							Click="BtnScanAllProgs_Click" />
						</StackPanel>
						<TextBox 
							Grid.Row="1"
							Margin="8,6,32,12" 
							Name="TxtFolder" Grid.ColumnSpan="4" />
						<Button 
							Grid.Row="1"
							MinWidth="24"
							Margin="0,6,4,12" Name="BtnFolder" Click="BtnFolder_Click" Grid.Column="3">...</Button>
						<Button 
							Grid.Row="1" 
							Margin="0,6,4,12" 
							Name="_BtnSearch" Click="BtnSearch_Click" Content="{Binding Source={x:Static am:Strings.SCAN}}" Grid.Column="4" />
						<Button 
							Grid.Row="1" 
							Width="24"
							Margin="0,6,8,12" 
							Name="BtnAddScan" 
							Click="BtnAddScan_Click" 
							Grid.Column="5">+</Button>
					</Grid>
					<ListView 
						Margin="8,0" Name="AppScanList" Grid.Row="1" 
						HorizontalContentAlignment="Stretch"
						ItemContainerStyle="{StaticResource AppItemStyle}">
						<!---->
						<ListView.View>
							<GridView AllowsColumnReorder="false">
								<GridViewColumn HeaderTemplate="{StaticResource myHeaderTemplate}" CellTemplate="{StaticResource CheckCell}" Width="26"/>
								<GridViewColumn CellTemplate="{StaticResource SemiEditableAppInfo}" Header="{Binding Source={x:Static am:Strings.APPLICATION}}" Width="300"/>
							</GridView>
						</ListView.View>
					</ListView>
				</Grid>
			</TabItem>
		</TabControl>
		<Button 
			Content="{Binding Source={x:Static am:Strings.OK}}"
			Margin="0,8,94,8" 
			Grid.Row="1" 
			Width="80" 
			HorizontalAlignment="Right" 
			x:Name="BtnOK" 
			Click="BtnOK_Click" />
		<Button 
			Content="{Binding Source={x:Static am:Strings.CANCEL}}"
			HorizontalAlignment="Right" Margin="0,8,8,8" Width="80" Grid.Row="1" Name="BtnCancel" Click="BtnCancel_Click" />
	</Grid>
</Window>